<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Bluepill: a GCC/CMake build environment ..</title>
<!-- 2018-08-20 Mon 19:10 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="George Kontsevich" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="../static/worg.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Bluepill: a GCC/CMake build environment ..</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">Intro</a>
<ul>
<li><a href="#sec-1-1">Prior Art</a></li>
</ul>
</li>
<li><a href="#sec-2">Anatomy of a build</a>
<ul>
<li><a href="#sec-2-1">The Startup File</a></li>
<li><a href="#sec-2-2">The STM Libraries</a></li>
<li><a href="#sec-2-3">Our blinky code (WIP)</a></li>
<li><a href="#sec-2-4">The toolchain</a></li>
<li><a href="#sec-2-5">The Linker Script</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Intro</h2>
<div class="outline-text-2" id="text-1">
<p>
In this guide we will setup a simple minimal blinky for the Bluepill. I will have two versions - one using the CMSIS and one using the LL (explained below). The embedded community seems a bit allergic to CMake - but I'm quite allergic to Make, so hopefully this guide will provide something new.
</p>

<p>
starting our CMake file we write out the usual
</p>

<div class="org-src-container">

<pre class="src src-cmake"><span style="color: #ef2929;">cmake_minimum_required</span>(VERSION 3.0)
<span style="color: #ef2929;">project</span>(blinky)
</pre>
</div>

<p>
The blessed way of building things for the STM32 series chips is using their wizards - but it's possible to get the whole thing running just using GCC and OpenOCD - and that's what we're gunna try to get working by the end of this guide. People have ofcourse already done this before:
</p>
</div>

<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1">Prior Art</h3>
<div class="outline-text-3" id="text-1-1">
<ul class="org-ul">
<li><code>dwelch67</code> has some great extremely minimal setups for the blue pilll on <a href="https://github.com/dwelch67/stm32_samples/tree/master/STM32F103C8T6">his github</a>. He describes them extensively in a <a href="https://electronics.stackexchange.com/questions/30736/stm32f2-makefile-linker-script-and-start-up-file-combination-without-commercia">few places on Stack Overflow</a>. Basically here he rolls his own .. everything. It's very greybeard. All the code is in your face - no libraries. Straight writting to registers. Definitely take a look!
</li>

<li><code>PurpleAlien</code> has another setup - which is very close to what I'm doing. He described it <a href="https://www.purplealienplanet.com/node/69">on his website</a> and the code is on the <a href="https://github.com/PurpleAlien/stm32-minimal">his github</a>. It's a slightly different chip - but the steps should work almost identically for the <code>bluepill</code>.
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Anatomy of a build</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1">The Startup File</h3>
<div class="outline-text-3" id="text-2-1">
<p>
This first catch with programming the microcontroller is that the system can't simply start at the top of <code>main()</code> and work through the code like on a normal machine. When the chip is powered off the program is stored permanently in the Flash memory (ROM) and because there is no operating system to loading the program into RAM we need to do that ourselves in addition to initializing system clocks and event handlers.
</p>

<p>
B/c this process is independent of the rest of the program itself it's canonically separating it out into a "startup file". This is generally written in assembly and reused between projects. I have absolutely no clue how to write one from scratch. STM provides several different versions in their templates - all called <code>startup_stm32f103xb.s</code> and at the top of these files it explains the general purpose:
</p>

<blockquote>
<ul class="org-ul">
<li>This module performs:
</li>
<li>- Set the initial SP
</li>
<li>- Set the initial PC == Reset<sub>Handler</sub>,
</li>
<li>- Set the vector table entries with the exceptions ISR address
</li>
<li>- Configure the clock system   
</li>
<li>- Branches to main in the C library (which eventually
</li>
<li>calls main()).
</li>
</ul>
</blockquote>

<p>
Unfortunately each startup file looks nothing like any other and I have very little way to judge which one I need - so it's a bit of guessing game and hoping it'll work. I've copied one over that seems to work for me for the moment. If this becomes an issue then I might need to revisit it.
</p>

<p>
We need to tell CMake that this file will include assembly so that it doesnt' freak out
</p>

<div class="org-src-container">

<pre class="src src-cmake"><span style="color: #ef2929;">enable_language</span>(ASM)
<span style="color: #ef2929;">set</span>(STARTUP_FILE <span style="color: #ff1f8b;">"startup_stm32f103xb.s"</span>)
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2">The STM Libraries</h3>
<div class="outline-text-3" id="text-2-2">
<p>
Next we need actual libraries to write code with - otherwise we are kinda stuck writing assembly and poking at memory addresses with the datasheet. These are all provided in one bundle called <b>Cube</b> and it's on <a href="https://www.st.com/content/st_com/en/products/embedded-software/mcus-embedded-software/stm32-embedded-software/stm32cube-mcu-packages/stm32cubef1.html">the STM website</a>. Here is a quick digest of what you get:
</p>

<ul class="org-ul">
<li>The <b>BSP</b> has board specific peripheral libraries.. since we aren't using a board from STM - this really doesn't concern us.
</li>

<li>The <b>HAL</b> that comes from STM is the standard <b>Hardware Abstraction Layer</b>. It will be making some simplifying assumptions and do some stuff more automatically for you. I'm going to skip setting this up. Blinking a light should be pretty simple - so I'm shooting to get it working with simpler APIs
</li>

<li>Hidden inside of the <b>HAL</b> folder you will see files that are names <code>stm32f1xx_ll_*.c/h</code>. These actually form a seperate sub-library of sorts called the  <b>LL</b> API (for <b>Low Level</b>)
</li>

<li>The <b>CMSIS</b> ( Cortex Microcontroller Software Interface Standard ) : This library comes from ARM (<i>not STM</i>). It's split into several semi-independent components and provides a common base for all ARM devices (independent of vendor). The <b>HAL</b> and <b>LL API</b> are built on top of the <b>CMSIS</b>
</li>
</ul>

<p>
Both the <b>HAL</b> and <b>CMSIS</b> need some chip-specific configuration - b/c while the API is standard, under the hood things will change from chip to chip (like memory addresses of things or clock information). I've bundled the <b>LL API</b> and the <b>CMSIS</b> together in a separate project <a href="https://geokon-gh.github.io/stm32f1-ll/index.html">stm32f1-ll</a> (<a href="https://github.com/geokon-gh/stm32f1-ll/">github</a>). It's also building with CMake so we can use it directly in our project (and you can skip registration and downloading the <b>Cube</b> thing). I recommend checking out that project's webpage for more details on how it works - but there is very little magic going on. 
</p>

<p>
The library bundle has been added as a submodule to this project, but if you forgot to clone recursively you can clone it right now into the project root with <code>git clone https://github.com/geokon-gh/stm32f1-ll/</code>. Once we have it there we can just add it in
</p>

<div class="org-src-container">

<pre class="src src-cmake"><span style="color: #ef2929;">add_subdirectory</span>(stm32f1-ll)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3">Our blinky code (WIP)</h3>
<div class="outline-text-3" id="text-2-3">
<p>
Next we can write a little program to blink a light and put it into <code>/src/main.c</code>
</p>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;stdlib.h&gt;</span>

<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">"stm32f1xx.h"</span>

<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">"stm32f1xx_ll_gpio.h"</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">"stm32f1xx_ll_utils.h"</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">"stm32f1xx_ll_rcc.h"</span>
<span style="color: #b2b2b2; font-style: italic;">//</span><span style="color: #b2b2b2; font-style: italic;">#include "stm32f1xx_conf.h"</span>

<span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">SystemClock_Config</span>(<span style="color: #18b2b2;">void</span>){

    <span style="color: #b2b2b2; font-style: italic;">/* </span><span style="color: #b2b2b2; font-style: italic;">Clock init stuff </span><span style="color: #b2b2b2; font-style: italic;">*/</span> 

    <span style="color: #18b2b2;">LL_UTILS_PLLInitTypeDef</span> <span style="color: #ff8700;">sUTILS_PLLInitStruct</span> = {LL_RCC_PLL_MUL_3, LL_RCC_PLL_DIV_3};
    <span style="color: #18b2b2;">LL_UTILS_ClkInitTypeDef</span> <span style="color: #ff8700;">sUTILS_ClkInitStruct</span> = {LL_RCC_SYSCLK_DIV_1, LL_RCC_APB1_DIV_1, LL_RCC_APB2_DIV_1};

    LL_PLL_ConfigSystemClock_HSI(&amp;sUTILS_PLLInitStruct, &amp;sUTILS_ClkInitStruct);

    LL_Init1msTick(SystemCoreClock);
}

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>(<span style="color: #18b2b2;">void</span>){

    <span style="color: #b2b2b2; font-style: italic;">/* </span><span style="color: #b2b2b2; font-style: italic;">Configure the system clock </span><span style="color: #b2b2b2; font-style: italic;">*/</span>
    SystemClock_Config();

    <span style="color: #b2b2b2; font-style: italic;">/* </span><span style="color: #b2b2b2; font-style: italic;">Let's pick a pin and toggle it </span><span style="color: #b2b2b2; font-style: italic;">*/</span>

    <span style="color: #b2b2b2; font-style: italic;">/* </span><span style="color: #b2b2b2; font-style: italic;">Use a structure for this (usually for bulk init), you can also use LL functions </span><span style="color: #b2b2b2; font-style: italic;">*/</span>   
    <span style="color: #18b2b2;">LL_GPIO_InitTypeDef</span> <span style="color: #ff8700;">GPIO_InitStruct</span>;

    <span style="color: #b2b2b2; font-style: italic;">/* </span><span style="color: #b2b2b2; font-style: italic;">Enable the GPIO clock for GPIOA</span><span style="color: #b2b2b2; font-style: italic;">*/</span>
    LL_AHB1_GRP1_EnableClock(LL_AHB1_GRP1_PERIPH_GPIOA);

    <span style="color: #b2b2b2; font-style: italic;">/* </span><span style="color: #b2b2b2; font-style: italic;">Enable clock for SYSCFG </span><span style="color: #b2b2b2; font-style: italic;">*/</span>
    LL_APB2_GRP1_EnableClock(LL_APB2_GRP1_PERIPH_SYSCFG);

    <span style="color: #b2b2b2; font-style: italic;">/* </span><span style="color: #b2b2b2; font-style: italic;">Set up port A parameters </span><span style="color: #b2b2b2; font-style: italic;">*/</span>
    LL_GPIO_StructInit(&amp;GPIO_InitStruct);                   <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">init the struct with some sensible defaults </span>
    GPIO_InitStruct.Pin = LL_GPIO_PIN_5;                    <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">GPIO pin 5; on Nucleo there is an LED</span>
    GPIO_InitStruct.Speed = LL_GPIO_SPEED_FREQ_LOW;         <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">output speed</span>
    GPIO_InitStruct.Mode = LL_GPIO_MODE_OUTPUT;             <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">set as output </span>
    GPIO_InitStruct.OutputType = LL_GPIO_OUTPUT_PUSHPULL;   <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">make it a push pull</span>
    LL_GPIO_Init(GPIOA, &amp;GPIO_InitStruct);                  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">initialize PORT A</span>

    <span style="color: #b2b2b2; font-style: italic;">/* </span><span style="color: #b2b2b2; font-style: italic;">Toggle forever </span><span style="color: #b2b2b2; font-style: italic;">*/</span>
    <span style="color: #00af00;">while</span>(1){
        LL_mDelay(250);
        LL_GPIO_TogglePin(GPIOA, LL_GPIO_PIN_5);
    }

    <span style="color: #00af00;">return</span> 0;
}
</pre>
</div>

<p>
Once there we can just add it as a special executable into our cmake
</p>
<div class="org-src-container">

<pre class="src src-cmake"><span style="color: #ef2929;">add_executable</span>(${<span style="color: #ff8700;">PROJECT_NAME</span>}.elf ${<span style="color: #ff8700;">STARTUP_FILE</span>} 
  src/main.c
  src/stm32f1xx_it.c
  src/system_stm32f1xx.c)
<span style="color: #ef2929;">target_include_directories</span>(${<span style="color: #ff8700;">PROJECT_NAME</span>}.elf PUBLIC inc)
</pre>
</div>
<p>
and then link it to our library
</p>
<div class="org-src-container">

<pre class="src src-cmake"><span style="color: #ef2929;">target_link_libraries</span>(${<span style="color: #ff8700;">PROJECT_NAME</span>}.elf ll )
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-2-4" class="outline-3">
<h3 id="sec-2-4">The toolchain</h3>
<div class="outline-text-3" id="text-2-4">
<p>
Now that we have the code to start up the chip and the code to blink a light we just need to specify the compiler and flags we will run. I'm building using <code>gcc-arm-none-eabi</code> and its associated tools. I did this on a Debian system where this version of gcc can be installed from the repository (name <code>gcc-arm-none-eabi</code>)
</p>

<p>
Canonically this is done in a separate file so that you can subsitute other possible toolchains (like for instance LLVM or custom versions of GCC). We won't be doing that here, but for the sake of convention I've written these configurations to a <code>toolchain.cmake</code>
</p>

<div class="org-src-container">

<pre class="src src-cmake"><span style="color: #ef2929;">set</span>(CMAKE_SYSTEM_NAME Generic) <span style="color: #b2b2b2; font-style: italic;"># 'Generic' is used for embedded systems</span>

<span style="color: #ef2929;">set</span>(CMAKE_C_COMPILER arm-none-eabi-gcc)
<span style="color: #ef2929;">set</span>(CMAKE_CXX_COMPILER arm-none-eabi-g++)
<span style="color: #ef2929;">set</span>(CMAKE_ASM_COMPILER arm-none-eabi-gcc)

<span style="color: #b2b2b2; font-style: italic;"># tells CMake not to try to link executables during its interal checks</span>
<span style="color: #b2b2b2; font-style: italic;"># things are not going to link properly without a linker script</span>
<span style="color: #ef2929;">set</span>(CMAKE_TRY_COMPILE_TARGET_TYPE STATIC_LIBRARY)

<span style="color: #ef2929;">set</span>(CMAKE_OBJCOPY arm-none-eabi-objcopy)
<span style="color: #ef2929;">set</span>(CMAKE_OBJDUMP arm-none-eabi-objdump)
<span style="color: #ef2929;">set</span>(CMAKE_SIZE arm-none-eabi-size)
<span style="color: #ef2929;">set</span>(CMAKE_DEBUGGER arm-none-eabi-gdb)
<span style="color: #ef2929;">set</span>(CMAKE_DEBUGGER arm-none-eabi-gdb)
<span style="color: #ef2929;">set</span>(CMAKE_CPPFILT arm-none-eabi-c++filt)
</pre>
</div>
<p>
If you skip writing a toolchain file then CMake will default to the system compiler and things will start to slowly go wrong for you (it generally doesn't blow up into your face here)
</p>

<p>
We then also need to let the compiler know our target architecture and some compiler options (taken from <a href="https://github.com/PurpleAlien/stm32-minimal/blob/master/Makefile">PurpleAlien</a>)
</p>

<div class="org-src-container">

<pre class="src src-cmake"><span style="color: #ef2929;">target_compile_options</span>(${<span style="color: #ff8700;">PROJECT_NAME</span>}.elf PUBLIC
  -Wall 
  -g 
  -std=gnu99 
  -Os
  -mthumb
  -mcpu=cortex-m3
  -mfloat-abi=soft
  -mlittle-endian
  -ffunction-sections 
  -fdata-sections
  -Werror 
  -Wstrict-prototypes 
  -Warray-bounds 
  -fno-strict-aliasing 
  -Wno-unused-const-variable 
  -specs=nano.specs 
  -specs=nosys.specs)
</pre>
</div>
<p>
<b>TODO</b> Explain all of these&#x2026;
</p>
</div>
</div>
<div id="outline-container-sec-2-5" class="outline-3">
<h3 id="sec-2-5">The Linker Script</h3>
<div class="outline-text-3" id="text-2-5">
<p>
The last bit to get everything working together is a special script that we feed to the linker (specified above in the toolchain)
</p>

<p>
When an application normally runs on a desktop machine it's generally running using virtual memory in a virtual application-specific address space. From the applications point of view it can manipulate it's own memory however it wants - and it's the operating system that then translates that into safe operations on the actually memory (for instance to insure that the applications doesn't touch any memory region it shouldn't)
</p>

<p>
On a simple microcontroller there is no operating system to manage the memory, and the memory is shared with other functionality. As we saw in the startup script, some addresses are reserved for peripherals, other addresses are for interrupts and reset bits, the stack and heap are allocated some place and there is also a split between ROM and RAM. So we can't just use the default linker and let it do whatever it wants. We need to specify the address space it can use via a linker script.
</p>

<p>
Here CMake is a deficient, but you can tell it about a linker script with the following lines:
</p>

<div class="org-src-container">

<pre class="src src-cmake"><span style="color: #ef2929;">set_target_properties</span>(
  ${<span style="color: #ff8700;">PROJECT_NAME</span>}.elf 
  PROPERTIES 
  LINK_FLAGS 
  <span style="color: #ff1f8b;">"-T${</span><span style="color: #ff8700;">PROJECT_SOURCE_DIR</span><span style="color: #ff1f8b;">}/STM32F103RBTx_FLASH.ld \</span>
<span style="color: #ff1f8b;">   -Wl,--gc-sections \</span>
<span style="color: #ff1f8b;">   -Wl,-Map=${</span><span style="color: #ff8700;">PROJECT_NAME</span><span style="color: #ff1f8b;">}.map"</span>)
</pre>
</div>

<p>
I'm appending this to the <code>CMakeLists.txt</code>, but it's maybe something that should be in the toolchain file.
</p>

<p>
I also added two more linker options (you can see it's a linker option by the <code>-Wl</code> before it)
</p>

<ul class="org-ul">
<li><code>--gc-sections</code> this tells the linker to remove unused code/data from the final executable. There is a pesky <code>_exit()</code> function referrence that will often get slipped into your executable by the compiler. B/c we are running on a microcontroller the code never exits (it can't quit and hand off executation to an OS after all!) so this exit needs to be removed by the linker. Otherwise the linker will complain you never defined an exit function.
</li>

<li><code>-Map</code> prints a link map:
1 - Where object files and symbols are mapped into memory.
2 - How common symbols are allocated.
3 - All archive members included in the link, with a mention of the symbol which caused the archive member to be brought in.
</li>
</ul>

<p>
The link map is like a high-level overview of how your code looks like
</p>

<p>
More linker options are explained in details here: <a href="https://ftp.gnu.org/old-gnu/Manuals/ld-2.9.1/html_node/ld_3.html">https://ftp.gnu.org/old-gnu/Manuals/ld-2.9.1/html_node/ld_3.html</a>
</p>

<blockquote>
<p>
<b>Note</b>:in <code>STM32Cube_FW_F1_V1.6.0/Middlewares</code> there are additional libraries that sorta live on top of all of this and do more complicated stuff like TCP/IP USB..stuff and Filesystem things. Basically things that are kinda complicated you probably want to avoid writing yourself. I'm completely skipping this :)
</p>
</blockquote>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: George Kontsevich</p>
<p class="date">Created: 2018-08-20 Mon 19:10</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 25.2.2 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
